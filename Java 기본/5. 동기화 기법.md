## 1. Mutual Exclusion(뮤텍스)
- 공유 자원에 대한 경쟁 상태를 방지
- 동시성 제어를 위한 락 메커니즘
- Mutex 락을 가진 오직 한 개의 스레드만이 임계영역에 진이발 수 있으며 락을 획득한 스레드만이 락을 획득
	- 스레드가 임계영역에서 **Mutex 객체의 플래그**를 소유하고 있으면 다른 스레드가 엑세스 할 수 없음.
	- **Mutex 객체의 플래그**가 해제된 경우에만 액세스 할 수 있음

### 1.1문제점
#### 데드락
- 두 개 이상의 스레드가 서로 가진 락을 기다리면서 블로킹되어 아무 작업도 수행할 수 없는 상태
#### 우선 순위 역전
- 높은 우선 순위를 가진 스레드가 낮은 우선 수누이를 가진 스레드가 보유한 락을 기다리는 동안 블록되는 현상
#### 오버헤드
- 여러 스레드가 경합하면서 락을 얻기 위해 스레드 스케쥴링이 발생 -> 오버헤드 발생
#### 성능 저하
- 락을 얻기 위해 스레드가 대기, 스레드 실행 시간이 블록되면서 성능 저하
#### 오사용
- 잘못된 순서로 락을 해제하는 경우 예기치 않은 동작이 발생할 수 있음
---
## 2. Semaphore
- 공유 자원에 대한 접근을 제어하기 위해 사용되는 신호 전달 메커니즘
- 정수형 변수 `S`와 `P(Proberen: try)`, `V(Verhogen: increment)` 두 가지 원자적 함수로 구성됨
	- P는 임계 영역을 사용하려는 스레드의 진입 여부를 결정하는 연산(Wait 연산)
	- V는 대기 중인 프로세스를 깨우는 신호(Signal 연산)
	

>[!Note]
>- 자바에서는 java.util.concurrent 패키지에 semaphore를 포함하고 있기 때문에 직접 구현할 필요는 없음

### 2.1 세마포어 작동 방식


| 구분     | S                                | P 연산 (Wait 연산)                          | V 연산 (Signal 연산)                        |
| ------ | -------------------------------- | --------------------------------------- | --------------------------------------- |
| **의미** | 정수형 변수                           | S가 1 감소 (S--)                           | S가 1 증가 (S++)                           |
| **설명** | 공유 자원의 개수로서 이 개수만큼 스레드의 접근이 허용된다 | 스레드가 임계 구역에 진입하기 전 실행되어 카운트의 값을 1 감소시킨다 | 스레드가 임계 구역에서 빠져나올 때 실행되어 카운트 값을 1 증가시킨다 |
#### 동기화
- S가 0보다 크면 공유자원 접근이 허용되며 S가 0이면 공유 자원 접근이 거부됨
- 같은 세마포어의 P, V 함수의 S연산은 여러 스레드 간 동시에 실행이 되지 않도록 원자적 실행이 보장돼야함

### 2.2 유형
#### 이진 세마포어
- 카운트 변수 S가 1인 세마포어
- 뮤텍스처럼 락으로 사용하기 위해선, 카운트 변수를 1로 설정하고 한 스레드 안에서 세마포어를 획득하고 해제할 수 있도록 함
#### 카운팅 세마포어
- 카운트 변수가 2 이상인 세마포어
- 스레드가 공유할 수 있는 자원의 최대치를 한정해서 운용하는 방식으로 **자원 pool이나 컬렉션 크기 제한을 두고자 할 때 유용**
- 락을 획득한 스레드와 락을 해제하는 스레드는 다를 수 있음
- 스레드 간 락과 락 해제를 위한 신호를 전달함으로써 동기화 구현
- 어느 스레드를 먼저 수행해도 항상 ==Signal -> Wait== 순서로 실행됨


```java
pulic class Test{
	
	private static Semaphore semaphore = new Semaphore(3);
}
```


### 2.3 뮤텍스와 세마포어
#### 동작 방식
- 뮤텍스: 공유 자원에 대한 접근을 동시에 하나의 스레드만 가능하도록 함
- 세마포어: 
	- 카운팅 기법으로, 특정 개수의 스레드가 도잇에 공유 자원에 접근할 수 있도록 제어(카운팅 세마포어)
	- 이진 세마포어는 뮤텍스와 유사한 역할 가능
#### 소유권
- 뮤텍스: 락을 획득한 스레드만이 락을 해제 가능, 다른 스레드는 해당 뮤텍스에 접근할 수 없음
- 세마포어: 
	- 소유권이 없음, 
	- 특정 개수의 스레드가 동시에 접근을 허용할 수 있음
	- 세마포어를 사용하는 스레드들이 모두 세마포어를 해제할 수 있음
#### 초기값
- 뮤텍스: 기본적으로 잠금상태로 시작
- 세마포어: 초기값을 설정할 수 있으며 처음부터 접근가능한 스레드를 설정 가능

#### 사용 목적
- 뮤텍스: 상호 배제를 위해 사용, 하나의 스레드만 접근하도록 보장해야 하는 경우
- 세마포어: 리소스의 한정적인 사용을 제어, 특정 개수의 스레드만이 도잇에 자원에 접근하도록 제한

>[!Note]
>- Java는 뮤텍스를 고도화한 Monitor 객체와 Semaphore를 구현체를 제공하고 있음